# 礼品码兑换系统配置文件示例
# 复制此文件为 config.yaml 并根据需要修改

server:
  host: "0.0.0.0"
  port: 10999
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 60s
  cors:
    enabled: true
    allow_origins:
      - "*"  # 允许所有来源，生产环境应该指定具体域名
    allow_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"
    allow_headers:
      - "Origin"
      - "Content-Type"
      - "Accept"
      - "Authorization"
      - "X-Request-ID"
    expose_headers:
      - "X-Request-ID"
    allow_credentials: false
    max_age: 3600  # 预检请求缓存时间（秒）

database:
  path: "./giftcode.db"
  max_open_conns: 25
  max_idle_conns: 5
  conn_max_lifetime: 5m

captcha:
  providers:
    # 阿里云OCR配置
    - type: "ali"
      access_key: "${ACCESS_KEY}"      # 从环境变量读取
      secret_key: "${ACCESS_SECRET}"   # 从环境变量读取
    
    # 腾讯云OCR配置
    - type: "tencent"
      access_key: "${TC_ACCESS_KEY}"
      secret_key: "${TC_SECRET_KEY}"
    
    # Google Cloud Vision OCR配置
    # 需要先在 Google Cloud Console 中：
    # 1. 创建项目并启用 Cloud Vision API
    # 2. 创建服务账号并授予 "Cloud Vision API User" 角色
    # 3. 下载服务账号 JSON 密钥文件
    # 
    # 配置选项：
    # - 方式1: 将 JSON 内容作为字符串设置到 credentials_json
    # - 方式2: 使用环境变量 GOOGLE_CREDENTIALS_JSON
    # - 方式3: 设置 GOOGLE_APPLICATION_CREDENTIALS 环境变量指向 JSON 文件路径，
    #         并将 credentials_json 留空
    - type: "google"
      credentials_json: "${GOOGLE_CREDENTIALS_JSON}"  # Google Cloud服务账号JSON密钥
      # 或留空使用 GOOGLE_APPLICATION_CREDENTIALS 环境变量
      # credentials_json: ""

job:
  delay_time: 2s       # 任务启动延迟
  period_time: 30s     # 任务执行周期
  worker_pool_size: 5  # 并发工作线程数

logging:
  level: "info"  # 日志级别: debug, info, warn, error
  format: "json" # 日志格式: json, text

security:
  rate_limit:
    enabled: true
    rate: 10   # 每秒允许的请求数
    burst: 20  # 允许的突发请求数

# 管理后台配置
admin:
  username: "admin"  # 管理员用户名
  # 管理员密码的bcrypt哈希值
  # 生成方法: 使用bcrypt工具或在线生成器
  # 示例密码 "admin123" 的哈希值（仅用于开发环境）:
  password_hash: "$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy"
  # JWT签名密钥（生产环境必须使用强随机密钥）
  # 生成方法: openssl rand -base64 32
  token_secret: "your-secret-key-change-in-production-min-32-chars"
  # JWT令牌有效期
  token_duration: 24h

# 通知配置
notification:
  wxpusher:
    # WxPusher应用Token
    # 获取方法: 在 https://wxpusher.zjiecode.com 注册并创建应用
    app_token: "${WXPUSHER_APP_TOKEN}"  # 从环境变量读取
    # WxPusher用户UID
    # 获取方法: 关注WxPusher公众号后获取
    uid: "${WXPUSHER_UID}"              # 从环境变量读取

# 环境变量覆盖说明:
# - ADMIN_USERNAME: 覆盖管理员用户名
# - ADMIN_PASSWORD_HASH: 覆盖管理员密码哈希
# - ADMIN_TOKEN_SECRET: 覆盖JWT签名密钥
# - ADMIN_TOKEN_DURATION: 覆盖令牌有效期（如 "24h", "12h", "1h30m"）
# - WXPUSHER_APP_TOKEN: 覆盖WxPusher应用Token
# - WXPUSHER_UID: 覆盖WxPusher用户UID
